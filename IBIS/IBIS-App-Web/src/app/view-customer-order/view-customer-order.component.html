
<article class="table-header">
    <h2>Customer Order:</h2>
    
    <h2>{{title}}</h2>

    <button *ngIf="edit" class="button-add-row" [disabled]="edited" mat-button (click)="addRow()">Add Row</button>
   
  </article>
  <form action="" [formGroup]="form">
  <table mat-table #orderTable formArrayName="records" [dataSource]="dataSource">
    <ng-container [matColumnDef]="col.key" *ngFor="let col of columnsSchema">
      <th mat-header-cell *matHeaderCellDef>
        {{ col.label }}
      </th>
      <div [ngSwitch]="col.type" >
        <div *ngSwitchCase="'total'">
         hi
      <td mat-footer-cell *matFooterCellDef>Total: R{{ CalculateSubTotal()}} </td>
        </div>
        <div *ngSwitchCase="'number'">
         
          <td mat-footer-cell *matFooterCellDef><p style="color:darkgoldenrod;" *ngIf="quantityGreater">
          Warning:Quantity is greater than stock on hand
        </p> </td>
        </div>

    <div *ngSwitchDefault>
    <td mat-footer-cell *matFooterCellDef> </td>
    </div>
</div>
    
      <td mat-cell *matCellDef="let element; let rowIndex = index"  [formGroupName]="rowIndex">
        <div [ngSwitch]="col.type" *ngIf="element.isDone">
         
         <section *ngSwitchCase="'isDone'" >
          <div class="btn-edit">
            <button [disabled]="edited==true" *ngIf="edit" mat-button (click)="element.isDone = !element.isDone;editRow(rowIndex);">
              Edit
            </button>
          </div>
         </section>
         
       
        
       
          <div *ngSwitchCase="'isDelete'">
            
              <button mat-button *ngIf="edit" (click)="DeleteRow(rowIndex)" >Delete</button>
              
            </div>
            <span *ngSwitchCase="'total'">
              {{CalculateTotal(rowIndex)}}
              
             </span>
             <span *ngSwitchCase="'product_ID'">
              {{element.name}}
             
             </span>
          
          <span *ngSwitchDefault>
            {{ element[col.key] }}
            
          </span>
          <!-- <input type="hidden" [formControlName]="element.IsEdit" #isEdit /> -->
         </div> 
        <div [ngSwitch]="col.type" *ngIf="!element.isDone">
         
          <!-- display2(element) -->
          <mat-form-field *ngSwitchCase="'product_ID'"  >
            <mat-label>Select Product</mat-label>
            <mat-select #select formControlName="product_ID" (closed)="SetPrevious(rowIndex)" (opened)="Reset(rowIndex)" (selectionChange)="SetPrice($event,rowIndex)" >
              <mat-option>
                <input matInput (keyup)="onKey($any($event.target).value)" (click)="$event.stopPropagation()" (keydown)="$event.stopPropagation()"/>
               
            </mat-option>
                <mat-option *ngFor="let product of filteredDropDown" [value]="product.product_ID">
                  {{product.name}}
                </mat-option>
              </mat-select>
  
            
          </mat-form-field>
          <div *ngSwitchCase="'isDelete'">
            <button style="float: right;" mat-button (click)="DeleteRow(rowIndex)" *ngIf="edit" >Delete</button>
            <button *ngIf="edited && edit" [disabled]="!form.valid" class="button-add-row"  (click)="OnDone(rowIndex)" mat-button style="float: right;">Done</button>
             
            </div>
            <span *ngSwitchCase="'total'">
              {{CalculateTotal(rowIndex)}}
             
             </span>
            <div *ngSwitchCase="'isDone'">
                 <input type="hidden">

                 
    
                
            </div>
         
            <div *ngSwitchCase="'price'">
             
              <input type="number" formControlName="price" matInput list="price" />
              <datalist *ngIf="element.price" id="price">
             <option [value]="FindPrice(element.product_ID)"  >
              {{FindPrice(element.product_ID)}}
             </option>
            </datalist>
            </div>
           
           
            <mat-form-field  *ngSwitchDefault>
              <input  #Input *ngIf="element.product_ID" [type]="col.type" [formControlName]="col.key" (keyup)="CheckQuantity(Input.value,element.product_ID)" matInput />
              {{ConsoleLog(element,col.key)}}

             
            </mat-form-field>
  
        </div>
       
       
      </td>
    </ng-container> 
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    <tr mat-footer-row *matFooterRowDef="displayedColumns;sticky:true"></tr>
  </table>
  <input (click)="Edit()" *ngIf="dataSource.data.length > 0 && edit" style="width: 200px!important;" type="submit" value="Update" [disabled]="!form.valid ||edited==true">
  </form>


